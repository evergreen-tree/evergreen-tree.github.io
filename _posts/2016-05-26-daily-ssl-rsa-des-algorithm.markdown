---
layout: post
title:  "[技术每日说] - SSL是如何加密传输的数据的!"
date:   2016-05-25 10:57:01 +0800
categories: daily hadoop
---

> 真正深度去解析技术的文章越来越少了，而且百度基本搜索不出来这一类的文章(其实很大一部分的原因不是百度没有能力而是人家的平台主动屏蔽了百度的爬虫)，本文站在前人的肩膀上试图以浅显易懂的语言解释一下SSL的原理以及为什么SSL是安全的。

<!--more-->

# 什么叫做SSL

HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版（HTTP+SSL）。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

> 为了描述的简单性，本文中默认对称加密使用的算法为DES，非对称加密的算法使用的是RSA

# SSL使用到的技术

- 秘钥交换算法（自己去搜索吧，我忘记叫啥了）
- 秘钥传输保密算法(这个是用的非对称加密，一般为RSA，HTTPS网站的证书里面所带的就是RSA的一个公钥)
- 数据加密算法(这个使用的是对称加密算法，DES这种，然后为了保证安全，每个链接使用的秘钥是不同的)

首先，很重要的一点，要搞明白的就是SSL在进行`传输数据`的`加密解密所`使用的算法为对称加密，相对于非对称加密，对称加密被破解的风险会更高，但是因为非对称加解密的效率实在太低，所以传输数据的过程中采用的是使用`秘钥`进行加密的`对称加密`的算法，例如DES。但是接下来怎么让服务器和客户端使用相同的秘钥进行数据的加解密就成了问题，所以为了秘钥的传输的安全性，在进行`秘钥交换(DES的秘钥)`的过程中使用RSA进行秘钥传输的安全性加密。然后秘钥交换算法是干什么的呢？其实在进行DES的秘钥传输的过程中，传输的并非是真实使用的加密的密钥，而是用来生成密钥的一个叫做二级密钥的内容，然后通过一系列的复杂的数学运算，来得到真实的密钥。

具体的交换的数学公式为`(g^b%p)^a%p=(g^a%p)^b%p`，简单理解为一个素数的b次幂对于某个数取余然后在进行a次幂再对该数取余等于将两个幂次的操作交换过来，所以实际上传输的过程中，只要两端同时知道参与操作的g跟用来取余的p，然后双方只要把自己选定的一个幂次传输给对方，即能完成对于秘钥的交换，即客户端只要通知服务器我要使用的数字为a，而服务器只要告诉客户端我选用的数字为b，即可运算得到相同的结果作为密钥。

`记住一点，DES进行数据加密，RSA对DES使用的秘钥进行加密（只需要进行一次即可）`

对于SSL的密钥交换算法的一些分析可以看一下下面的文章：

<https://evergreen-tree.github.io/articles/2016-05/daily-java-keytool-ssl-cacerts>

# SSL协议的工作过程

![SSL协议栈](/static/img/ssl/ssl_pro.png)

SSL位于应用层和传输层之间，它可以为任何基于TCP等可靠连接的应用层协议提供安全性保证。SSL协议本身分为两层：

* 上层为SSL握手协议（SSL handshake protocol）、SSL密码变化协议（SSL change cipher spec protocol）和SSL警告协议（SSL alert protocol）；
* 底层为SSL记录协议（SSL record protocol）。

其中：

* SSL握手协议：是SSL协议非常重要的组成部分，用来协商通信过程中使用的加密套件（加密算法、密钥交换算法和MAC算法等）、在服务器和客户端之间安全地交换密钥、实现服务器和客户端的身份验证。
* SSL密码变化协议：客户端和服务器端通过密码变化协议通知对端，随后的报文都将使用新协商的加密套件和密钥进行保护和传输。
* SSL警告协议：用来向通信对端报告告警信息，消息中包含告警的严重级别和描述。
* SSL记录协议：主要负责对上层的数据（SSL握手协议、SSL密码变化协议、SSL警告协议和应用层协议报文）进行分块、计算并添加MAC值、加密，并把处理后的记录块传输给对端。



参照文档：

<http://www.symantec.com/connect/blogs/how-does-ssl-work-what-ssl-handshake>

<http://iluoxuan.iteye.com/blog/1736275>

<https://segmentfault.com/a/1190000002554673>